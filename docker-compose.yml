---
version: '3.7'

services:

    elasticsearch:
        image: docker.elastic.co/elasticsearch/elasticsearch:6.8.4
        environment:
            ES_JAVA_OPTS: -Xms512m -Xmx512m
            discovery.type: single-node
        ports:
            - ${ES_PORT}:9200
        stdin_open: true
        tty: true

    backend:
        depends_on:
            - elasticsearch
        build:
            context: .
            args:
                - es_port=${ES_PORT}
                - es_host=localhost
        ports:
            - 8090:8090
        tty: true
        network_mode: host

    tla-populate:
        depends_on:
            - backend
        build:
            context: https://github.com/jkatzwinkel/tla-populate.git
            args:
                - SAMPLE_URL=${SAMPLE_URL}
                - BACKEND_URL=http://backend:8090
        command: http://localhost:8090
        tty: true
        network_mode: host

